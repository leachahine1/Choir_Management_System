{
    "sourceFile": "ISFM/modules/section_trainers/controllers/section_trainers.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1715173932717,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1715173932717,
            "name": "Commit-0",
            "content": "<?php\ndefined('BASEPATH') OR exit('No direct script access allowed');\n\nclass Section_trainers extends CI_Controller {\n\n    function __construct() {\n        parent::__construct();\n        if (!$this->ion_auth->logged_in()) {\n            redirect('auth/login');\n        }\n    }\n\n    public function section_trainersInformation() {\n        if ($this->input->post('submit', TRUE)) {\n            $Choir_id = $this->input->post('Choir_id', TRUE);\n            $selected_section = $this->input->post('section', TRUE); // Get selected section name\n            $data['Choir_title'] = $this->common->Choir_title($Choir_id);\n            $data['selected_section'] = $selected_section; // Pass selected section name to the view\n            $data['section_trainers'] = $this->common->getWhere22('section_trainers_info', 'Choir_id', $Choir_id, 'section', $selected_section); // Fetch trainers for the selected section\n            $this->load->view('temp/header');\n            $this->load->view('section_trainersInformation', $data);\n            $this->load->view('temp/footer');\n        } else {\n            $data['s_Choir'] = $this->common->getAllData('Choir');\n            $this->load->view('temp/header');\n            $this->load->view('section_trainers', $data);\n            $this->load->view('temp/footer');\n        }\n    }\n\n    public function ajaxChoirSection() {\n        $Choir_id = $this->input->get('q');\n        $query = $this->common->getWhere('Choir', 'id', $Choir_id);\n        foreach ($query as $row) {\n            $data = $row;\n        }\n        echo '<input type=\"hidden\" name=\"Choir_title\" value=\"' . $data['id'] . '\">';\n        if (!empty($data['section'])) {\n            $section = $data['section'];\n            $sectionArray = explode(\",\", $section);\n            echo '<div class=\"form-group\">\n                        <label class=\"col-md-3 control-label\">'.lang('clasc_3').' <span class=\"requiredStar\"> * </span></label>\n                        <div class=\"col-md-6\">\n                            <select name=\"section\" class=\"form-control\">\n                                <option value=\"all\">'.lang('clasc_4').'</option>';\n            foreach ($sectionArray as $sec) {\n                echo '<option value=\"' . $sec . '\">' . $sec . '</option>';\n            }\n            echo '</select></div>\n                    </div>';\n        } else {\n            echo '<div class=\"form-group\">\n                        <label class=\"col-md-3 control-label\"></label>\n                        <div class=\"col-md-6\">\n                        <div class=\"alert alert-warning\">\n                                <strong>'.lang('clasc_5').'</strong> '.lang('clasc_6').'\n                        </div></div></div>';\n        }\n    }\n\n    public function editSection_trainersInfo() {\n        $userId = $this->input->get('puid');\n        $section_trainersInfoId = $this->input->get('painid');\n    \n        if ($this->input->post('submit', TRUE)) {\n            // Process form data\n            $username = $this->input->post('first_name', TRUE) . ' ' . $this->input->post('last_name', TRUE);\n            $additional_data = array(\n                'username' => $this->db->escape_like_str($username),\n                'first_name' => $this->db->escape_like_str($this->input->post('first_name', TRUE)),\n                'last_name' => $this->db->escape_like_str($this->input->post('last_name', TRUE)),\n                'phone' => $this->db->escape_like_str($this->input->post('phone', TRUE)),\n                'email' => $this->db->escape_like_str($this->input->post('email', TRUE)),\n            );\n    \n            // Update user info\n            $this->db->where('id', $userId);\n            $this->db->update('users', $additional_data);\n    \n            $additionalData1 = array(\n                'section_trainers_name' => $this->db->escape_like_str($username),\n                'level' => $this->db->escape_like_str($this->input->post('guardianLevel', TRUE)),\n                'email' => $this->db->escape_like_str($this->input->post('email', TRUE)),\n                'phone' => $this->db->escape_like_str($this->input->post('phone', TRUE)),\n            );\n    \n            // Update trainers info\n            $this->db->where('id', $section_trainersInfoId);\n            $this->db->update('section_trainers_info', $additionalData1);\n    \n            $data['success'] = '<br><div class=\"col-md-12\"><div class=\"alert alert-info alert-dismissable admisionSucceassMessageFont\">\n            <button aria-hidden=\"true\" data-dismiss=\"alert\" class=\"close\" type=\"button\"></button>\n            <strong>' . lang('success') . '</strong>' . lang('parc_4') . '\n                </div></div>';\n            $this->load->view('temp/header');\n            $this->load->view('section_trainers', $data);\n            $this->load->view('temp/footer');\n        } else {\n            // Load edit form\n            $data['info'] = $this->common->getWhere('section_trainers_info', 'id', $section_trainersInfoId);\n            if (empty($data['info'])) {\n                $data['info'] = array(); // Ensure $info is always an array\n            }\n    \n            $this->load->view('temp/header');\n            $this->load->view('editSection_trainers', $data);\n            $this->load->view('temp/footer');\n        }\n    }\n    public function deleteSection_trainers() {\n        $userID = $this->input->get('UcsHeRnHdtfgrfGshId');\n        $section_trainersInfoId = $this->input->get('pdfdsfAjhgdfrRdfeNdsfdtSjdcfgdInfOdfgdfhIdnfd');\n\n        $this->db->delete('users', array('id' => $userID));\n        $this->db->delete('section_trainers_info', array('id' => $section_trainersInfoId));\n\n        redirect(\"section_trainers/section_trainersInformation\", 'refresh');\n    }\n}"
        }
    ]
}