{
    "sourceFile": "ISFM/modules/songs/controllers/songs.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1715169812525,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1715169855591,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -191,9 +191,9 @@\n         // Check if the JSON data is not empty\n         if (!empty($data)) {\n             // Execute Python script and capture both stdout and stderr\n             $pythonScript = 'C:\\xampp\\htdocs\\Choir_Management_System-final\\comparison\\FYP-master\\final_results.py';\n-            $pythonPath = 'C:\\Users\\oudka\\OneDrive\\Desktop\\Rawan\\FYPenv\\Scripts\\python.exe';\n+            $pythonPath = 'C:\\Users\\Charles\\AppData\\Local\\Programs\\Python\\Python312\\Scripts\\python.exe';\n             exec(\"$pythonPath $pythonScript 2>&1\", $output, $returnCode);\n \n             // Log errors and output to a file\n             $errorLog = fopen('error_log.txt', 'a'); // Open log file in append mode\n"
                },
                {
                    "date": 1715169982031,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -191,9 +191,9 @@\n         // Check if the JSON data is not empty\n         if (!empty($data)) {\n             // Execute Python script and capture both stdout and stderr\n             $pythonScript = 'C:\\xampp\\htdocs\\Choir_Management_System-final\\comparison\\FYP-master\\final_results.py';\n-            $pythonPath = 'C:\\Users\\Charles\\AppData\\Local\\Programs\\Python\\Python312\\Scripts\\python.exe';\n+            $pythonPath = 'C:\\Users\\Charles\\AppData\\Local\\Programs\\Python\\Python312\\python.exe';\n             exec(\"$pythonPath $pythonScript 2>&1\", $output, $returnCode);\n \n             // Log errors and output to a file\n             $errorLog = fopen('error_log.txt', 'a'); // Open log file in append mode\n"
                }
            ],
            "date": 1715169812525,
            "name": "Commit-0",
            "content": "<?php\nif (!defined('BASEPATH')) {\n    exit('No direct script access allowed');\n}\nclass Songs extends MX_Controller {\n    function __construct() {\n        parent::__construct();\n        $this->load->model('song_model');\n        if (!$this->ion_auth->logged_in()) {\n            redirect('auth/login');\n        }\n    }\n    //THis function add new song in a Choir\n    public function addSong() {\n        if ($this->input->post('submit', TRUE)) {\n            $Choir_id = $this->input->post('Choir_id', TRUE);\n            $song_1_a = $this->input->post('song_title_1', TRUE);\n            $edition = $this->input->post('edition', TRUE);\n            $writer_name = $this->input->post('writer_name', TRUE);\n            $tableData = array(\n                'Choir_id' => $this->db->escape_like_str($Choir_id),\n                'year' => $this->db->escape_like_str(date('Y')),\n                'song_title' => $this->db->escape_like_str($song_1_a),\n                'edition' => $this->db->escape_like_str($edition),\n                'writer_name' => $this->db->escape_like_str($writer_name),\n                'optional' => $this->db->escape_like_str($this->input->post('optionalSong', TRUE))\n            );\n            if ($this->db->insert('Choir_song', $tableData)) {\n                $data['success'] = '<div class=\"alert alert-info alert-dismissable admisionSucceassMessageFont\">\n                                            <button aria-hidden=\"true\" data-dismiss=\"alert\" class=\"close\" type=\"button\"></button>\n                                            <strong>'.lang('success').'</strong> '.lang('sub_1').' \"' . $song_1_a . '\" '.lang('sub_2').'\n                                    </div>';\n                $data['Choir'] = $this->common->getAllData('Choir');\n                $data['section_leader'] = $this->common->getAllData('section_leaders_info');\n                $this->load->view('temp/header');\n                $this->load->view('addSong', $data);\n                $this->load->view('temp/footer');\n            }\n        } else {\n            $data['Choir'] = $this->common->getAllData('Choir');\n            $data['section_leader'] = $this->common->getAllData('section_leaders_info');\n            $this->load->view('temp/header');\n            $this->load->view('addSong', $data);\n            $this->load->view('temp/footer');\n        }\n    }\n    //This function load all song with Choir\n    public function allSong() {\n        $data['SongInfo'] = $this->common->getAllData('Choir');\n        $this->load->view('temp/header');\n        $this->load->view('songInformation', $data);\n        $this->load->view('temp/footer');\n    }\n    //This function view song deatils by Choir title\n    public function ChoirSongDetails() {\n        $Choir_id = $this->input->get('c_id');\n        $data['SongInfo'] = $this->common->getWhere('Choir_song', 'Choir_id', $Choir_id);\n        $this->load->view('temp/header');\n        $this->load->view('ChoirSongDetails', $data);\n        $this->load->view('temp/footer');\n    }\n    //This function will set Choir_members optional song\n    public function set_optional() {\n        if ($this->input->post('submit', TRUE)) {\n            $stu_id = $this->input->post('Choir_member_id', TRUE);\n            $upload_data = array(\n                'optional_sub' => $this->db->escape_like_str($this->input->post('op_sub', TRUE))\n            );\n            $this->db->where('Choir_member_id', $stu_id);\n            if ($this->db->update('Choir_Choir_members', $upload_data)) {\n                $data['Choir'] = $this->common->getAllData('Choir');\n                $data['message'] = '<div class=\"alert alert-success alert-dismissable\">\n\t\t\t\t\t\t\t\t<button aria-hidden=\"true\" data-dismiss=\"alert\" class=\"close\" type=\"button\"></button>\n\t\t\t\t\t\t\t\t<strong>'.lang('success').'</strong> '.lang('sub_3').'\n\t\t\t\t\t\t\t</div>';\n                $this->load->view('temp/header');\n                $this->load->view('set_optional', $data);\n                $this->load->view('temp/footer');\n            }\n        } else {\n            $data['Choir'] = $this->common->getAllData('Choir');\n            $this->load->view('temp/header');\n            $this->load->view('set_optional', $data);\n            $this->load->view('temp/footer');\n        }\n    }\n    //This function will give the Choir_member information from Choir_memberID\n    public function Choir_memberInfoById() {\n        $Choir_memberId = $this->input->get('q', TRUE);\n        $query = $this->common->stuInfoId($Choir_memberId);\n        if (empty($query)) {\n            echo '<div class=\"form-group\">\n                    <label class=\"col-md-3 control-label\"></label>\n                        <div class=\"col-md-6\">\n                        <div class=\"alert alert-danger\">\n                            <strong>'.lang('sub_4').'</strong> '.lang('sub_5').' <strong>' . $Choir_memberId . '</strong> '.lang('sub_6').'\n                    </div></div></div>';\n        } else {\n            $Choir_id = $query->Choir_id;\n            $Choir_title = $this->common->Choir_title($Choir_id);\n            echo '<div class=\"row\"><div class=\"col-md-offset-2 col-md-7 stuInfoIdBox\">\n                    <div class=\"col-md-8\">\n                        <div class=\"form-group\">\n                            <label class=\"col-md-4 control-label\">'.lang('sub_7').' <span class=\"requiredStar\">  </span></label>\n                            <div class=\"col-md-8\">\n                                <input type=\"text\" class=\"form-control\" name=\"Choir_memberName\" value=\"' . $query->Choir_member_nam . '\" readonly>\n                            </div>\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"col-md-4 control-label\">'.lang('sub_8').' <span class=\"requiredStar\">  </span></label>\n                            <div class=\"col-md-8\">\n                                <input type=\"text\" class=\"form-control\" name=\"Choir_title\" value=\"' . $Choir_title . '\" readonly>\n                            </div>\n                        </div>\n                        <div id=\"ajax_result2\">\n                            <div  class=\"col-md-offset-3 col-md-9\">\n                                <button type=\"button\" class=\"btn purple btn-block\" onclick=\"optional_song(this.value)\" value=\"' . $Choir_id . '\">'.lang('sub_10').'</button><br>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <input type=\"hidden\" name=\"Choir_id\" value=\"' . $Choir_id . '\">\n                    <div class=\"col-md-2\">\n                        <img src=\"assets/uploads/' . $query->Choir_member_photo . '\" class=\"img-responsive\" alt=\"\"><br>\n                    </div>\n                </div></div>';\n        }\n    }\n\n    // Add this function inside the Songs controller class\n\npublic function graphs() {\n    // Your graph-related logic goes here\n    \n    // For example, let's say you want to display a bar chart of song counts per Choir\n    // You can fetch the data from the database using your model and pass it to a view\n    \n    // Fetch data from the model\n    $song_counts_per_choir = $this->song_model->getSongCountsPerChoir();\n\n    // Pass the data to a view\n    $data['song_counts'] = $song_counts_per_choir;\n    $this->load->view('temp/header');\n    $this->load->view('Graphs', $data); // Assuming you have a view named graphs_view.php\n    $this->load->view('temp/footer');\n}\n\n    //This function will return class optional song\n    public function optional_song() {\n        $Choir_id = $this->input->get('c_id', TRUE);\n        $song = $this->song_model->Choir_op_sub($Choir_id);\n        echo '<div class=\"form-group\">\n                    <label class=\"col-md-4 control-label\">'.lang('sub_9').' <span class=\"requiredStar\"> * </span></label>\n                    <div class=\"col-md-8\">\n                        <select class=\"form-control\" name=\"op_sub\" data-validation=\"required\">\n                            <option value=\"\">'.lang('select').'</option>';\n        foreach ($song as $row) {\n            echo '<option value=\"' . $row['song_title'] . '\">' . $row['song_title'] . '</option>';\n        }\n        echo '</select>\n                    </div>\n                </div>';\n    }\npublic function results() {\n     if ($this->input->post('submit', True)) {\n            $stu_id = $this->input->post('Choir_member_id', TRUE);\n            $upload_data = array(\n                'optional_sub' => $this->db->escape_like_str($this->input->post('op_sub', TRUE))\n            );\n\n\n            $this->db->where('Choir_member_id', $stu_id);\n            if ($this->db->update('Choir_Choir_members', $upload_data)) {\n\n             $data_to_save = array(\n                'Choir_member_id' => $stu_id,\n                'song_title' => $upload_data\n            );\n\n            // Convert data to JSON format\n            $json_data = json_encode($data_to_save);\n\n            // Write JSON data to song_title.json file\n            $json_file = 'song_title.json';\n            file_put_contents($json_file, $json_data);\n\n        // Read JSON file contents\n        $jsonData = file_get_contents($json_file);\n        $data = json_decode($jsonData);\n\n        // Check if the JSON data is not empty\n        if (!empty($data)) {\n            // Execute Python script and capture both stdout and stderr\n            $pythonScript = 'C:\\xampp\\htdocs\\Choir_Management_System-final\\comparison\\FYP-master\\final_results.py';\n            $pythonPath = 'C:\\Users\\oudka\\OneDrive\\Desktop\\Rawan\\FYPenv\\Scripts\\python.exe';\n            exec(\"$pythonPath $pythonScript 2>&1\", $output, $returnCode);\n\n            // Log errors and output to a file\n            $errorLog = fopen('error_log.txt', 'a'); // Open log file in append mode\n            if ($returnCode !== 0) {\n                fwrite($errorLog, \"Error executing Python script:\\n\");\n            }\n            foreach ($output as $line) {\n                fwrite($errorLog, \"$line\\n\");\n            }\n            fclose($errorLog); // Close the error log file\n        } else {\n            echo \"JSON data is empty.\";\n            // Handle the case where JSON data is empty\n        }\n    }\n}\n    // Load the view\n    $this->load->view('temp/header');\n    $this->load->view('results');\n    $this->load->view('temp/footer');\n}\n\n\npublic function deleteFiles() {\n    // Delete images\n    $files = glob('Images/*.png'); // Get all PNG files in the Images directory\n    foreach ($files as $file) {\n        unlink($file); // Delete each PNG file\n    }\n\n    // Delete song_title.json\n    unlink('song_title.json');\n\n}\n}"
        }
    ]
}