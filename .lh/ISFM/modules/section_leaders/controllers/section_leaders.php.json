{
    "sourceFile": "ISFM/modules/section_leaders/controllers/section_leaders.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1714842754490,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1714842754490,
            "name": "Commit-0",
            "content": "<?php\r\n\r\nif (!defined('BASEPATH')) {\r\n    exit('No direct script access allowed');\r\n}\r\n\r\nclass Section_leaders extends MX_Controller {\r\n\r\n    /**\r\n     * This controller is using for control section_leaders work\r\n     * \r\n     * Maps to the following URL\r\n     * \t\thttp://rehearsalple.com/index.php/section_leaders\r\n     * \t- or -  \r\n     * \t\thttp://rehearsalple.com/index.php/section_leaders/<method_name>\r\n     */\r\n    function __construct() {\r\n        parent::__construct();\r\n        if (!$this->ion_auth->logged_in()) {\r\n            redirect('auth/login');\r\n        }\r\n        $this->load->model('section_leadermodel');\r\n    }\r\n\r\n    //This function gives all section_leader's short informattion in a table view\r\n    public function allSection_leaders() {\r\n        $data['section_leader'] = $this->section_leadermodel->allSection_leaders();\r\n        $this->load->view('temp/header');\r\n        $this->load->view('section_leaders', $data);\r\n        $this->load->view('temp/footer');\r\n    }\r\n    public function section_leadersInformation() {\r\n        if ($this->input->post('submit', TRUE)) {\r\n            $Choir_id = $this->input->post('Choir_id', TRUE);\r\n            $selected_section = $this->input->post('section', TRUE); // Get selected section name\r\n            $data['Choir_title'] = $this->common->Choir_title($Choir_id);\r\n            $data['selected_section'] = $selected_section; // Pass selected section name to the view\r\n            $data['section_leaders'] = $this->common->getWhere22('section_leaders_info', 'Choir_id', $Choir_id, 'section', $selected_section); // Fetch trainers for the selected section\r\n            $this->load->view('temp/header');\r\n            $this->load->view('section_leadersInformation', $data);\r\n            $this->load->view('temp/footer');\r\n        } else {\r\n            $data['s_Choir'] = $this->common->getAllData('Choir');\r\n            $this->load->view('temp/header');\r\n            $this->load->view('section_leaders', $data);\r\n            $this->load->view('temp/footer');\r\n        }\r\n    }\r\n\r\n    public function ajaxChoirSection() {\r\n        $Choir_id = $this->input->get('q');\r\n        $query = $this->common->getWhere('Choir', 'id', $Choir_id);\r\n        foreach ($query as $row) {\r\n            $data = $row;\r\n        }\r\n        echo '<input type=\"hidden\" name=\"Choir_title\" value=\"' . $data['id'] . '\">';\r\n        if (!empty($data['section'])) {\r\n            $section = $data['section'];\r\n            $sectionArray = explode(\",\", $section);\r\n            echo '<div class=\"form-group\">\r\n                        <label class=\"col-md-3 control-label\">'.lang('clasc_3').' <span class=\"requiredStar\"> * </span></label>\r\n                        <div class=\"col-md-6\">\r\n                            <select name=\"section\" class=\"form-control\">\r\n                                <option value=\"all\">'.lang('clasc_4').'</option>';\r\n            foreach ($sectionArray as $sec) {\r\n                echo '<option value=\"' . $sec . '\">' . $sec . '</option>';\r\n            }\r\n            echo '</select></div>\r\n                    </div>';\r\n        } else {\r\n            echo '<div class=\"form-group\">\r\n                        <label class=\"col-md-3 control-label\"></label>\r\n                        <div class=\"col-md-6\">\r\n                        <div class=\"alert alert-warning\">\r\n                                <strong>'.lang('clasc_5').'</strong> '.lang('clasc_6').'\r\n                        </div></div></div>';\r\n        }\r\n    }\r\n\r\n    //This function gives all details about any section_leader\r\n    public function section_leaderDetails() {\r\n        $id = $this->input->get('id');\r\n        $userId = $this->input->get('uid');\r\n        $data['section_leader'] = $this->common->getWhere('section_leaders_info', 'id', $id);\r\n        $data['user'] = $this->common->getWhere('users', 'id', $userId);\r\n        $this->load->view('temp/header');\r\n        $this->load->view('section_leaderDetails', $data);\r\n        $this->load->view('temp/footer');\r\n    }\r\n    //This function is using for editing a section_leader informations\r\n    //And admin an select group  \r\n    function edit_section_leader() {\r\n        $userId = $this->input->get('uid');\r\n        $section_leaderId = $this->input->get('id');\r\n        if ($this->input->post('submit', TRUE)) {\r\n            $edu_1 = '';\r\n            $edu_2 = '';\r\n            $edu_3 = '';\r\n            $edu_4 = '';\r\n            $edu_5 = '';\r\n            if ($this->input->post('dd_1', TRUE)) {\r\n                $edu_1 = $this->input->post('dd_1') . ',' . $this->input->post('scu_1', TRUE) . ',' . $this->input->post('result_1', TRUE) . ',' . $this->input->post('paYear_1', TRUE);\r\n            }\r\n            if ($this->input->post('dd_2', TRUE)) {\r\n                $edu_2 = $this->input->post('dd_2') . ',' . $this->input->post('scu_2', TRUE) . ',' . $this->input->post('result_2', TRUE) . ',' . $this->input->post('paYear_2', TRUE);\r\n            }\r\n            if ($this->input->post('dd_3', TRUE)) {\r\n                $edu_3 = $this->input->post('dd_3') . ',' . $this->input->post('scu_3', TRUE) . ',' . $this->input->post('result_3', TRUE) . ',' . $this->input->post('paYear_3', TRUE);\r\n            }\r\n            if ($this->input->post('dd_4', TRUE)) {\r\n                $edu_4 = $this->input->post('dd_4') . ',' . $this->input->post('scu_4', TRUE) . ',' . $this->input->post('result_4', TRUE) . ',' . $this->input->post('paYear_4', TRUE);\r\n            }\r\n            if ($this->input->post('dd_5', TRUE)) {\r\n                $edu_5 = $this->input->post('dd_5') . ',' . $this->input->post('scu_5', TRUE) . ',' . $this->input->post('result_5', TRUE) . ',' . $this->input->post('paYear_5');\r\n            }\r\n            $username = strtolower($this->input->post('first_name', TRUE)) . ' ' . strtolower($this->input->post('last_name', TRUE));\r\n            $additional_data = array(\r\n                'username' => $this->db->escape_like_str($username),\r\n                'email' => $this->db->escape_like_str($this->input->post('email', TRUE)),\r\n                'first_name' => $this->db->escape_like_str($this->input->post('first_name', TRUE)),\r\n                'last_name' => $this->db->escape_like_str($this->input->post('last_name', TRUE)),\r\n                'phone' => $this->db->escape_like_str($this->input->post('phone', TRUE)),\r\n            );\r\n            $this->db->where('id', $userId);\r\n            $this->db->update('users', $additional_data);\r\n            $section_leadersInfo = array(\r\n                'fullname' => $this->db->escape_like_str($username),\r\n                'farther_name' => $this->db->escape_like_str($this->input->post('father_name', TRUE)),\r\n                'mother_name' => $this->db->escape_like_str($this->input->post('mother_name', TRUE)),\r\n                'birth_date' => $this->db->escape_like_str($this->input->post('birthdate', TRUE)),\r\n                'sex' => $this->db->escape_like_str($this->input->post('sex', TRUE)),\r\n                'present_address' => $this->db->escape_like_str($this->input->post('present_address', TRUE)),\r\n                'permanent_address' => $this->db->escape_like_str($this->input->post('permanent_address', TRUE)),\r\n                'position' => $this->db->escape_like_str($this->input->post('position', TRUE)),\r\n                'working_hour' => $this->db->escape_like_str($this->input->post('workingHoure', TRUE)),\r\n                'educational_qualification_1' => $this->db->escape_like_str($edu_1),\r\n                'educational_qualification_2' => $this->db->escape_like_str($edu_2),\r\n                'educational_qualification_3' => $this->db->escape_like_str($edu_3),\r\n                'educational_qualification_4' => $this->db->escape_like_str($edu_4),\r\n                'educational_qualification_5' => $this->db->escape_like_str($edu_5),\r\n                'cv' => $this->db->escape_like_str($this->input->post('cv', TRUE)),\r\n                'educational_certificat' => $this->db->escape_like_str($this->input->post('educational_certificat', TRUE)),\r\n                'exprieance_certificatte' => $this->db->escape_like_str($this->input->post('exc', TRUE)),\r\n                'files_info' => $this->db->escape_like_str($this->input->post('submited_info', TRUE))\r\n            );\r\n            $this->db->where('id', $section_leaderId);\r\n            $this->db->update('section_leaders_info', $section_leadersInfo);\r\n            $data['section_leader'] = $this->common->getAllData('section_leaders_info');\r\n            $this->load->view('temp/header');\r\n            $this->load->view('section_leaders', $data);\r\n            $this->load->view('temp/footer');\r\n        } else {\r\n            //get all data about this section_leader from the \"user\" table\r\n            $data['userInfo'] = $this->common->getWhere('users', 'id', $userId);\r\n            $data['section_leaderInfo'] = $this->common->getWhere('section_leaders_info', 'id', $section_leaderId);\r\n            //get all groupe information and current group information to view file by \"$data\" array.\r\n            $data['groups'] = $this->ion_auth->groups()->result_array();\r\n            $data['currentGroups'] = $this->ion_auth->get_users_groups($userId)->result();\r\n            $this->load->view('temp/header');\r\n            $this->load->view('editSection_leader', $data);\r\n            $this->load->view('temp/footer');\r\n        }\r\n    }\r\n    //This function is use for delete a section_leader.\r\n    public function section_leaderDelete() {\r\n        $section_leaderId = $this->input->get('id');\r\n        $userId = $this->input->get('uid');\r\n        $this->db->delete('section_leaders_info', array('id' => $section_leaderId));\r\n        $this->db->delete('users', array('id' => $userId));\r\n        redirect('section_leaders/allSection_leaders', 'refresh');\r\n    }\r\n}"
        }
    ]
}